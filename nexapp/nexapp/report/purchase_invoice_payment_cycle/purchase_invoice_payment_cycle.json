{
 "add_total_row": 0,
 "add_translate_data": 0,
 "columns": [],
 "creation": "2026-01-13 18:25:53.092813",
 "disabled": 0,
 "docstatus": 0,
 "doctype": "Report",
 "filters": [],
 "idx": 0,
 "is_standard": "Yes",
 "letter_head": "Nexapp",
 "letterhead": null,
 "modified": "2026-01-13 18:45:54.065171",
 "modified_by": "Administrator",
 "module": "Nexapp",
 "name": "Purchase Invoice Payment Cycle",
 "owner": "Administrator",
 "prepared_report": 0,
 "query": "SELECT\n    -- Purchase Invoice Core Details\n    pi.supplier AS \"Supplier:Link/Supplier:180\",\n    pi.bill_no AS \"Bill No::140\",\n    pi.bill_date AS \"Bill Date:Date:120\",\n    pi.rounded_total AS \"Rounded Total:Currency:120\",\n    pi.outstanding_amount AS \"Outstanding Amount:Currency:120\",\n    pi.status AS \"Status::120\",\n    pi.posting_date AS \"Posting Date:Date:120\",\n\n    -- Duration & Payment\n    pi.custom_dutation_from AS \"Duration From:Date:120\",\n    pi.custom_duration_to AS \"Duration To:Date:120\",\n    pi.custom_payment_cycle AS \"Payment Cycle::120\",\n    pi.custom_payment_type AS \"Payment Type::120\",\n    pi.custom_payment_catogery AS \"Payment Category::140\",\n\n    -- Circuit & Site Details\n    pi.custom_circuit_id AS \"Circuit ID::160\",\n    s.site_name AS \"Site Name::200\",\n    s.customer AS \"Customer:Link/Customer:180\",\n    s.site_status AS \"Site Status::120\",\n\n    -- LMS Details\n    pi.custom_lms_id AS \"LMS ID::140\",\n    lms.lms_stage AS \"LMS Stage::140\",\n\n    /* BANK ACCOUNT SET 1 */\n    MAX(CASE WHEN bo.rn = 1 THEN bo.account_name END) AS \"Bank Account Holder-1:Data:150\",\n    MAX(CASE WHEN bo.rn = 1 THEN bo.bank_account_no END) AS \"Bank Account No-1:Data:150\",\n    MAX(CASE WHEN bo.rn = 1 THEN bo.custom_ifsc END) AS \"IFSC Code-1:Data:120\",\n\n    /* BANK ACCOUNT SET 2 */\n    MAX(CASE WHEN bo.rn = 2 THEN bo.account_name END) AS \"Bank Account Holder-2:Data:150\",\n    MAX(CASE WHEN bo.rn = 2 THEN bo.bank_account_no END) AS \"Bank Account No-2:Data:150\",\n    MAX(CASE WHEN bo.rn = 2 THEN bo.custom_ifsc END) AS \"IFSC Code-2:Data:120\",\n\n    /* BANK ACCOUNT SET 3 */\n    MAX(CASE WHEN bo.rn = 3 THEN bo.account_name END) AS \"Bank Account Holder-3:Data:150\",\n    MAX(CASE WHEN bo.rn = 3 THEN bo.bank_account_no END) AS \"Bank Account No-3:Data:150\",\n    MAX(CASE WHEN bo.rn = 3 THEN bo.custom_ifsc END) AS \"IFSC Code-3:Data:120\",\n\n    /* BANK ACCOUNT SET 4 */\n    MAX(CASE WHEN bo.rn = 4 THEN bo.account_name END) AS \"Bank Account Holder-4:Data:150\",\n    MAX(CASE WHEN bo.rn = 4 THEN bo.bank_account_no END) AS \"Bank Account No-4:Data:150\",\n    MAX(CASE WHEN bo.rn = 4 THEN bo.custom_ifsc END) AS \"IFSC Code-4:Data:120\",\n\n    /* BANK ACCOUNT SET 5 */\n    MAX(CASE WHEN bo.rn = 5 THEN bo.account_name END) AS \"Bank Account Holder-5:Data:150\",\n    MAX(CASE WHEN bo.rn = 5 THEN bo.bank_account_no END) AS \"Bank Account No-5:Data:150\",\n    MAX(CASE WHEN bo.rn = 5 THEN bo.custom_ifsc END) AS \"IFSC Code-5:Data:120\"\n\nFROM `tabPurchase Invoice` pi\n\n-- Site linked via Circuit ID\nLEFT JOIN `tabSite` s\n    ON s.name = pi.custom_circuit_id\n\n-- LMS linked via LMS ID\nLEFT JOIN `tabLastmile Services Master` lms\n    ON lms.name = pi.custom_lms_id\n\n-- Bank Accounts (ranked per Supplier)\nLEFT JOIN (\n    SELECT\n        ba.party,\n        ba.account_name,\n        ba.bank_account_no,\n        ba.custom_ifsc,\n        ROW_NUMBER() OVER (\n            PARTITION BY ba.party\n            ORDER BY ba.creation\n        ) AS rn\n    FROM `tabBank Account` ba\n    WHERE\n        ba.party_type = 'Supplier'\n        AND ba.disabled = 0\n) bo\n    ON bo.party = pi.supplier\n\nWHERE\n    pi.status != 'Cancelled'\n    AND pi.docstatus = 1\n\nGROUP BY\n    pi.name\n\nORDER BY\n    pi.posting_date DESC;\n",
 "ref_doctype": "Purchase Invoice",
 "report_name": "Purchase Invoice Payment Cycle",
 "report_type": "Query Report",
 "roles": [
  {
   "role": "accounts receivable"
  },
  {
   "role": "Purchase User"
  },
  {
   "role": "Auditor"
  },
  {
   "role": "Accounts  & Finance Manager"
  },
  {
   "role": "Account Payable"
  },
  {
   "role": "Account Receivable User"
  },
  {
   "role": "LMS Manager"
  },
  {
   "role": "Stock Manager"
  },
  {
   "role": "LMS User"
  }
 ],
 "timeout": 0
}