{
 "add_total_row": 0,
 "add_translate_data": 0,
 "columns": [],
 "creation": "2025-10-15 21:30:08.407198",
 "disabled": 0,
 "docstatus": 0,
 "doctype": "Report",
 "filters": [],
 "idx": 10,
 "is_standard": "Yes",
 "letter_head": "Nexapp",
 "letterhead": null,
 "modified": "2026-01-31 11:21:39.566668",
 "modified_by": "Administrator",
 "module": "Nexapp",
 "name": "Site Billing",
 "owner": "Administrator",
 "prepared_report": 0,
 "query": "SELECT\n    (@rownum := @rownum + 1) AS \"Index:Int:60\",\n    si.name AS \"Circuit ID:Data:150\",\n    si.customer AS \"Customer:Data:150\",\n    si.site_name AS \"Site Name:Data:180\",\n    si.customer_type AS \"Customer Type:Data:120\",\n    si.order_type AS \"Order Type:Data:120\",\n    si.customer_po_no AS \"Customer PO No:Data:150\",\n    si.customer_po_date AS \"Customer PO Date:Date:120\",\n    si.site_status AS \"Site Stage:Data:120\",\n    si.stage AS \"Stock Stage:Data:120\",\n    si.lms_stage AS \"LMS Stage:Data:120\",\n\n    CASE\n        WHEN inv.custom_circuit_id IS NOT NULL THEN 'Billed'\n        ELSE 'Unbilled'\n    END AS \"Billing Status:Data:120\",\n\n    inv.invoice_list AS \"Invoice No:Data:250\",\n\n    si.sales_order AS \"Sales Order No:Link/Sales Order:150\",\n    si.date AS \"Circuit Delivery Date:Date:120\",\n    si.provisioning_partially_completed_date AS \"Provisioning Partially Completed Date:Date:150\",\n    si.provisioning_date AS \"Provisioning Completed Date:Date:150\"\n\nFROM `tabSite` si\nLEFT JOIN (\n    SELECT \n        sii.custom_circuit_id,\n        GROUP_CONCAT(DISTINCT sih.name ORDER BY sih.posting_date ASC SEPARATOR ', ') AS invoice_list\n    FROM `tabSales Invoice Item` sii\n    INNER JOIN `tabSales Invoice` sih\n        ON sii.parent = sih.name\n    WHERE sih.docstatus = 1\n      AND sih.status != 'Return'\n      AND sii.custom_circuit_id IS NOT NULL\n    GROUP BY sii.custom_circuit_id\n) inv ON inv.custom_circuit_id = si.name,\n(SELECT @rownum := 0) r\n\nORDER BY si.date DESC;\n",
 "ref_doctype": "Site",
 "report_name": "Site Billing",
 "report_type": "Query Report",
 "roles": [
  {
   "role": "System Manager"
  },
  {
   "role": "Administrator"
  },
  {
   "role": "accounts receivable"
  },
  {
   "role": "Accounts  & Finance Manager"
  },
  {
   "role": "Account Receivable User"
  },
  {
   "role": "Account Payable"
  }
 ],
 "timeout": 0
}